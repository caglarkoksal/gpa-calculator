<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GPA Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { width: 100%; max-width: 600px; margin: 0 auto; }
    .year { margin-top: 20px; }
    .warning { color: red; font-weight: bold; }
    input { margin-bottom: 10px; }
    h3 { margin-top: 30px; }
  </style>
</head>
<body>

<div class="container">
  <h1>GPA Calculator</h1>
  
  <!-- Disclaimer -->
  <p><strong>Disclaimer:</strong> This calculator is for educational purposes only and does not guarantee final GPA. No data is stored. Please input your final grade as per your transcript, especially if you have resat a module.</p>

  <!-- Program selection -->
  <label>Select your program:</label><br>
  <input type="radio" id="PRE" name="program" value="PRE" onclick="selectProgram()"> PRE<br>
  <input type="radio" id="MPlanMPRE" name="program" value="MPlanMPRE" onclick="selectProgram()"> MPlan/MPRE<br><br>

  <!-- Year inputs -->
  <div id="yearInputs"></div>

  <!-- Result display -->
  <div id="result"></div>
</div>

<script>
// Global variables for storing grade and credit information
let currentYear = 1;
let maxYears = 3;
let totalCredits = 0;
let creditsForYear = 120;
let totalGPA = { year1: [], year2: [], year3: [], year4: [] };

// Select program based on user input
function selectProgram() {
  const program = document.querySelector('input[name="program"]:checked').value;
  document.getElementById('yearInputs').innerHTML = ''; // Clear any existing inputs
  currentYear = 1;

  if (program === 'PRE') {
    maxYears = 3;
    createYearInput(1);
  } else if (program === 'MPlanMPRE') {
    maxYears = 4;
    createYearInput(1);
  }
}

// Create input form for each year
function createYearInput(year) {
  let yearDiv = document.createElement('div');
  yearDiv.classList.add('year');
  yearDiv.innerHTML = `
    <h3>Year ${year} (Input total of 120 credits)</h3>
    <div id="modulesYear${year}">
      <div class="module">
        <label for="unitName">Unit Name (Optional):</label>
        <input type="text" class="unitName">
        <label for="grade">Final Grade (0-100):</label>
        <input type="number" class="grade" min="0" max="100" required>
        <label for="credits">Credits:</label>
        <input type="number" class="credits" required>
        <button type="button" onclick="addModule(${year})">Add Module</button>
      </div>
    </div>
    <p id="creditsWarningYear${year}" class="warning"></p>
  `;
  document.getElementById('yearInputs').appendChild(yearDiv);
}

// Add module information to the year
function addModule(year) {
  const modulesDiv = document.getElementById(`modulesYear${year}`);
  const grade = parseFloat(modulesDiv.querySelector('.grade').value);
  const credits = parseFloat(modulesDiv.querySelector('.credits').value);

  // Validation for grades and credits
  if (isNaN(grade) || isNaN(credits) || credits <= 0 || grade < 0 || grade > 100) {
    alert('Please enter a valid grade (0-100) and credits.');
    return;
  }

  totalGPA[`year${year}`].push({ grade, credits });

  // Check credit total for the year
  const totalCredits = totalGPA[`year${year}`].reduce((acc, item) => acc + item.credits, 0);
  const warning = document.getElementById(`creditsWarningYear${year}`);
  if (totalCredits > 120) {
    warning.textContent = `You have exceeded the 120 credits limit. Please review your input.`;
  } else if (totalCredits < 120) {
    warning.textContent = `You have ${totalCredits} credits, missing ${120 - totalCredits} credits.`;
  } else {
    warning.textContent = `120 credits completed for Year ${year}.`;
  }

  // Automatically calculate GPA if year is complete
  if (totalCredits <= 120) {
    calculateFinalGPA();
  }
}

// Calculate final GPA based on the selected program
function calculateFinalGPA() {
  const program = document.querySelector('input[name="program"]:checked').value;
  let gpa = 0;

  if (program === 'PRE') {
    const year2GPA = calculateYearGPA(2);
    const year3GPA = calculateYearGPA(3);
    gpa = (year2GPA * 0.33) + (year3GPA * 0.67);
  } else if (program === 'MPlanMPRE') {
    const year2GPA = calculateYearGPA(2);
    const year3GPA = calculateYearGPA(3);
    const year4GPA = calculateYearGPA(4);
    gpa = (year2GPA * 0.2) + (year3GPA * 0.4) + (year4GPA * 0.4);
  }

  document.getElementById('result').innerHTML = `<h3>Your final GPA is: ${gpa.toFixed(2)}</h3>`;
}

// Calculate GPA for a specific year
function calculateYearGPA(year) {
  const yearData = totalGPA[`year${year}`];
  if (yearData.length === 0) return 0;
  
  const totalCredits = yearData.reduce((acc, item) => acc + item.credits, 0);
  const weightedSum = yearData.reduce((acc, item) => acc + (item.grade * item.credits), 0);
  
  return weightedSum / totalCredits;
}
</script>
</body>
</html>
